function liquidFillGaugeDefaultSettings(){return{minValue:0,maxValue:100,circleThickness:.05,circleFillGap:.05,circleColor:"#178BCA",waveHeight:.05,waveCount:1,waveRiseTime:1e3,waveAnimateTime:18e3,waveRise:!0,waveHeightScaling:!0,waveAnimate:!0,waveColor:"#178BCA",waveOffset:0,textVertPosition:.5,textSize:1,valueCountUp:!0,displayPercent:!0,textColor:"#045681",waveTextColor:"#A4DBf8"}}function loadLiquidFillGauge(t,a,c){null==c&&(c=liquidFillGaugeDefaultSettings());var m,e=d3.select("#"+t),n=Math.min(parseInt(e.style("width")),parseInt(e.style("height")))/2,r=parseInt(e.style("width"))/2-n,i=parseInt(e.style("height"))/2-n,l=Math.max(c.minValue,Math.min(c.maxValue,a))/c.maxValue;m=c.waveHeightScaling?d3.scale.linear().range([0,c.waveHeight,0]).domain([0,50,100]):d3.scale.linear().range([c.waveHeight,c.waveHeight]).domain([0,100]);var o=c.textSize*n/2,s=parseFloat(a).toFixed(2),u=c.valueCountUp?c.minValue:s,v=c.displayPercent?"%":"",d=c.circleThickness*n,p=d+c.circleFillGap*n,f=n-p,x=f*m(100*l),h=2*f/c.waveCount,w=1+c.waveCount,g=h*w,F=function(t){return Math.round(t)};parseFloat(s)!=parseFloat(F(s))&&(F=function(t){return parseFloat(t).toFixed(1)}),parseFloat(s)!=parseFloat(F(s))&&(F=function(t){return parseFloat(t).toFixed(2)});for(var T=[],C=0;C<=40*w;C++)T.push({x:C/(40*w),y:C/40});var y=d3.scale.linear().range([0,2*Math.PI]).domain([0,1]),M=d3.scale.linear().range([0,n]).domain([0,n]),A=d3.scale.linear().range([0,g]).domain([0,1]),P=d3.scale.linear().range([0,x]).domain([0,1]),R=d3.scale.linear().range([p+2*f+x,p-x]).domain([0,1]),V=d3.scale.linear().range([0,g-2*f]).domain([0,1]),I=d3.scale.linear().range([p+2*f,p+.7*o]).domain([0,1]),G=e.append("g").attr("transform","translate("+r+","+i+")"),H=d3.svg.arc().startAngle(y(0)).endAngle(y(1)).outerRadius(M(n)).innerRadius(M(n-d));G.append("path").attr("d",H).style("fill",c.circleColor).attr("transform","translate("+n+","+n+")");var S=G.append("text").text(F(u)+v).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",o+"px").style("fill",c.textColor).attr("transform","translate("+n+","+I(c.textVertPosition)+")"),q=d3.svg.area().x(function(t){return A(t.x)}).y0(function(t){return P(Math.sin(2*Math.PI*c.waveOffset*-1+2*Math.PI*(1-c.waveCount)+2*t.y*Math.PI))}).y1(function(t){return 2*f+x}),z=G.append("defs").append("clipPath").attr("id","clipWave"+t),B=z.append("path").datum(T).attr("d",q).attr("T",0),D=G.append("g").attr("clip-path","url(#clipWave"+t+")");D.append("circle").attr("cx",n).attr("cy",n).attr("r",f).style("fill",c.waveColor);var O=D.append("text").text(F(u)+v).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",o+"px").style("fill",c.waveTextColor).attr("transform","translate("+n+","+I(c.textVertPosition)+")");if(c.valueCountUp){var U=function(){var a=d3.interpolate(this.textContent,s);return function(t){this.textContent=F(a(t))+v}};S.transition().duration(c.waveRiseTime).tween("text",U),O.transition().duration(c.waveRiseTime).tween("text",U)}var k=p+2*f-g;function W(){B.attr("transform","translate("+V(B.attr("T"))+",0)"),B.transition().duration(c.waveAnimateTime*(1-B.attr("T"))).ease("linear").attr("transform","translate("+V(1)+",0)").attr("T",1).each("end",function(){B.attr("T",0),W(c.waveAnimateTime)})}return c.waveRise?z.attr("transform","translate("+k+","+R(0)+")").transition().duration(c.waveRiseTime).attr("transform","translate("+k+","+R(l)+")").each("start",function(){B.attr("transform","translate(1,0)")}):z.attr("transform","translate("+k+","+R(l)+")"),c.waveAnimate&&W(),new function(){this.update=function(t){var a=parseFloat(t).toFixed(2),e=function(t){return Math.round(t)};parseFloat(a)!=parseFloat(e(a))&&(e=function(t){return parseFloat(t).toFixed(1)}),parseFloat(a)!=parseFloat(e(a))&&(e=function(t){return parseFloat(t).toFixed(2)});var n=function(){var a=d3.interpolate(this.textContent,parseFloat(t).toFixed(2));return function(t){this.textContent=e(a(t))+v}};S.transition().duration(c.waveRiseTime).tween("text",n),O.transition().duration(c.waveRiseTime).tween("text",n);var r,i=Math.max(c.minValue,Math.min(c.maxValue,t))/c.maxValue,l=f*m(100*i),o=d3.scale.linear().range([p+2*f+l,p-l]).domain([0,1])(i),s=d3.scale.linear().range([0,g]).domain([0,1]),u=d3.scale.linear().range([0,l]).domain([0,1]);r=c.waveHeightScaling?d3.svg.area().x(function(t){return s(t.x)}).y0(function(t){return u(Math.sin(2*Math.PI*c.waveOffset*-1+2*Math.PI*(1-c.waveCount)+2*t.y*Math.PI))}).y1(function(t){return 2*f+l}):q;var d=c.waveAnimate?V(1):0;B.transition().duration(0).transition().duration(c.waveAnimate?c.waveAnimateTime*(1-B.attr("T")):c.waveRiseTime).ease("linear").attr("d",r).attr("transform","translate("+d+",0)").attr("T","1").each("end",function(){c.waveAnimate&&(B.attr("transform","translate("+V(0)+",0)"),W(c.waveAnimateTime))}),z.transition().duration(c.waveRiseTime).attr("transform","translate("+k+","+o+")")}}}